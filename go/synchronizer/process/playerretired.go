package process

import (
	"database/sql"
	"fmt"

	"github.com/freeverseio/crypto-soccer/go/contracts"
	"github.com/freeverseio/crypto-soccer/go/contracts/autogenerated/market"
	"github.com/freeverseio/crypto-soccer/go/storage"
)

func ConsumePlayerRetired(tx *sql.Tx, event market.MarketPlayerRetired) error {
	playerId := event.PlayerId
	player, err := storage.PlayerByPlayerId(tx, playerId)
	if err != nil {
		return err
	}
	if player == nil {
		return fmt.Errorf("unexistent player %v", playerId)
	}
	player.TeamId = contracts.NilAddress
	return player.Update(tx, event.Raw.BlockNumber)
}
